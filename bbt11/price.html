<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>price</title>
<!--收藏按钮CS-->
<meta name="description" content="Some ideas for modern button styles and effects">
<meta name="keywords" content="button, effect, hover, style, inspiration, web design">
<meta name="author" content="Codrops">
<link rel="shortcut icon" href="img/icon.png">
<link rel="stylesheet" type="text/css" href="./css/normalize.css">
<link rel="stylesheet" type="text/css" href="./css/vicons-font.css">
<link rel="stylesheet" type="text/css" href="./css/buttons.css">
<script id="_carbonads_projs" type="text/javascript" src="./css/C6AILKT.json"></script>
<!--导航cs-->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="css/autocomplete2.css">
<link rel="stylesheet" href="css/denglu2.css">
<link rel="stylesheet" href="css/zhuce2.css">
<script src="js/jquery-3.4.1(2).js" type="text/javascript"></script>
<script src="js/bootstrap2.js" type="text/javascript"></script>
<script src="res/plotly-latest.min.js" type="text/javascript"></script>
<!--框图cs-->
<link rel="stylesheet" href="css/base(2).css">
<link rel="stylesheet" href="css/index2.css"> 
<!--我的cs-->
<link rel="stylesheet" href="css/price2.css">
<!--搜索框js-->
<!-- <script type="text/javascript" src="js/jquery.js"></script> -->
<script type="text/javascript" src="js/autocomplete2.js"></script>
<!--百度js-->
<script type="text/javascript">
//var proposals = ['百度1', '百度2', '百度3', '百度4', '百度5', '百度6', '百度7','呵呵呵呵呵呵呵','百度','新浪','a1','a2','a3','a4','b1','b2','b3','b4'];
$(document).ready(function(){
	$('#search-form').autocomplete({
		//hints: proposals,
		width: 180,
		height: 30,
		//onSubmit: function(text){
			//$('#message').html('Selected: <b>' + text + '</b>');	
		//}
	});
});
</script>
</head>

<body>
<div id="wrapper">
<!--顶部导航-->
	<div id="header" class="navbar-fixed-top center-block">
		<nav class="navbar navbar-default navbar-inverse">
<!--		品牌名-->
			<a class="navbar-brand" href="index.html">bbt</a>
<!--			其他标签-->
			<div class="container-fluid">
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
<!--				主页-->
					<ul id="toIndex" class="nav navbar-nav index_all">
						<li><a href="index.html"><span class="glyphicon glyphicon-home" aria-hidden="true"></span>主页<span class="sr-only">(current)</span></a></li>
					</ul>
<!--				个人中心-->
					<ul id="toPersonal" class="nav navbar-nav person_all">
					<li><a href="personal.html"><span class="glyphicon glyphicon-user" aria-hidden="true"></span>个人中心<span class="sr-only">(current)</span></a></li>
					</ul>
<!--			好物推荐-->
				<div class="navbar-header">
					<ul id="toTuijian" class="nav navbar-nav tuijian_all">
						<li><a class="navbar-brand" href="tuijian.html"><span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>好物推荐<span class="sr-only">(current)</span></a></li>
					</ul>
				</div>
<!--			搜索-->
				<form id="transient" class="navbar-form navbar-left col-lg-2">
<!--				搜索框-->
					<div class="form-group search_box"  id="search-form">
					</div>
<!--					搜索框-->
				</form>
<!--				登录注册-->
					<!-- <ul class="nav navbar-nav navbar-right">
						<li><a href="#"><span class="glyphicon glyphicon-tag" aria-hidden="true"></span>退出账号</a></li>
					</ul> -->
				</div>
			</div>
		</nav>
	</div>
<!--	主体部分-->
	<div id="main" class="center-block">
		<div class="header center-block">
<!--		标题-->
			<div class="bg_header">
				<div class="header_nav fl t_title">
					<h1>价格曲线</h1>
				</div> 
			</div>
<!--			主要内容-->
			<div class="data_content">
				<div class="data_main">
<!--					左-->
					<div class="main_center fl">
						<!-- 用来放 hoverinfo -->
						<div id = "hoverinfo" class="show_data">
							<div class="right_1">
							</div>
						</div>
						<div class="center_text">
<!--							图名-->
							<div id="shopTitle" class="main_title">
								<img src="img/t_7.png" alt="">
								 价格波动
							</div>
						</div>
					</div>
<!--					右-->
					<div class="main_right fr">
<!--					右上-->
						<div id="getImg" class="right_1">
<!--							图名-->
							<div class="main_title">
								<img src="img/t_1.png" alt="">
								&nbsp; 价格分布
							</div>
						</div>
						<div class="right_1" id="car">
<!--							图名-->
							<div class="main_title">
								<img src="img/t_2.png" alt="">
								&nbsp;&nbsp;链接直通车
								<small id="toUrl"></small>
							<img src="img/Shape 290.png" class="shouzhi">
							</div>
							
						</div>
						<div class="right_1" id="car2">
<!--							图名-->
							<div class="main_title">
								<img src="img/t_5.png" alt="">
								&nbsp;&nbsp;加入收藏车
								<div class="box bg-1">
												<!--button--winona  -->
                					<button class="button  button--border-thin button--round-s" data-text="" id="collect"><span>收藏</span></button>
               						 <!--进入超链接-->
                					<img src="img/Shape 290.png" class="shouzhi2">
								</div>
						</div>
					</div>
					</div>
				</div>
			</div>
		</div>
	</div>
<!-- <!-	底部 -->
	 <div id="footer"  class="row">
	<!-- 超链接 -->
		<table>
			<tr>
				<th class="col-md-2">比价指南</th>
				<th class="col-md-2">合作伙伴</th>
				<th class="col-md-2">关于我们</th>
			</tr>
			<tr>
				<td><a href="">常见问题</a></td>
				<td><a href="">京东</a></td>
				<td><a href="">©2019比比淘版权所有</a></td>
			</tr>
			<tr>
				<td><a href="">联系客服</a></td>
				<td><a href="">天猫</a></td>
				<td><a href="">友情链接</a></td>
			</tr>
			<tr>
				<td><a href="">比价流程</a></td>
				<td><a href="">淘宝</a></td>
				<td><a href="">浙ICP备10201940号</a></td>
			</tr>
			<tr>
				<td></td>
				<td><a href="">唯品会</a></td>
				<td><a href="">浙公网安备33030802010083</a></td>
			</tr>
		</table>
<!--		置顶-->
		<div class="zhiding alert alert-danger" role="alert">
			<a href=""><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span></a>
		</div>
	</div> 
</div>
<!--进入按钮js-->
<script>

			(function() {

				var isSafari = !!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/);

				if(isSafari) {

					document.getElementById('support-note').style.display = 'block';

				}

			})();

</script>
</body>
</html>

<script>
function getUrl(){
	var deffered = new $.Deferred();
	$.getJSON("res/serverconfig.json",(responseText)=>{
		$url = responseText.protocol + responseText.domain+ ":" + responseText.port + responseText.context;
		//执行显示是否拿到数据
		//console.log($url);
		
		deffered.resolve($url);
	});
	var result = new $.Deferred();
 	deffered.then(function( serverconfig ) {
		$.getJSON("res/jumpconfig.json",(responseText)=>{
			$urls = responseText.protocol + responseText.domain;
			var getDict=[];
			getDict["serverconfig"]=serverconfig;
			getDict["jumpconfig"]=$urls;
			//执行显示是否拿到数据
			//console.log(getDict);
			result.resolve(getDict);
		});		
		
	}) 
	return result;
}

	$(function(){
		var def = getUrl();
		def.then(function(getDict){
	
		//关于登录注册 直接加上 就可以  删掉一个js
		//刷新页面 判定用户是否登录
		/* token无内容 说明还没有登录 判定用户是否登录 */
			//判断用户是否收藏
	var judgeCollect;
			
	//获取网址上的字段  并处理乱码
	var url = location.search;
	var arr_content = url.split('&');
	var goodsId = arr_content[0].split('=')[1];
	//var goodsTitle=decodeURI(arr_content[1].split('=')[1]);
	var shop = decodeURI(arr_content[1].split('=')[1]);
	var goodsPrice = decodeURI(arr_content[2].split('=')[1]);
	//console.log(goodsId+" "+shop+" "+goodsPrice)	
		
		if(localStorage.length == 0){
			$("#transient").after('<!--				登录注册--><ul class="nav navbar-nav navbar-right wsh "><li class="dropdown"><a href=" " class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-tag" aria-hidden="true"></span>登录/注册<span class="caret"></span></a><ul class="dropdown-menu"><li><a id="toLogin" href="#">登陆</a></li><li role="separator" class="divider"></li><li><a id="toRegist" href="#">注册</a></li><!-- <li>< a href="#">注销</ a></li> --></ul></li></ul>')
		}else{
			var tokens=localStorage.getItem("token");
			let $data={token:tokens};
			let data = JSON.stringify($data)
			$.ajax({
				type:"post",
				data:data,
				url:getDict.serverconfig+"/judgeLoginStatus.action",
				headers:{"Content-Type":"application/json;charset=UTF-8"},
				dataType:"json",
				success:function(responseText){
					if(responseText.status === "200"){   //"<p>欢迎您,"+responseText.userName+"		<a id='out' href='#'>注销</a></p>"
						$("#transient").after('<!--				登录注册--><ul class="nav navbar-nav navbar-right wsh "><li class="dropdown"><a href=" " class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-tag" aria-hidden="true"></span>欢迎您:'+responseText.userName+'<span class="caret"></span></a><ul class="dropdown-menu"><li><a id="out" href="#">注销</a></li><!-- <li>< a href="#">注销</ a></li> --></ul></li></ul>')
						
						goodsPrice = goodsPrice.replace("¥","");
						goodsPrice = goodsPrice.replace("￥","");
						
						//判定是否收藏
			 			var tokens=localStorage.getItem("token");
						let $data={
									token: tokens,
									goodsId: goodsId,
									goodsPrice:goodsPrice
									};
						let data = JSON.stringify($data);
						$.ajax({
							type:"post",
							data:data,
							url:getDict.serverconfig+"/judgeCollects.action",
							headers:{"Content-Type":"application/json;charset=UTF-8"},
							dataType:"json",
							success:function(responseText){
								if(responseText.status===200){
									judgeCollect=false
									$("#collect").html("取消收藏")
								}else{
									judgeCollect=true
									$("#collect").html("收藏")
								}
							},
							error:function(){
								//location.href=getDict.jumpconfig+"/404.html"
							}
						}); 
						
					}else{
						//登录过期
						$("#transient").after('<!--				登录注册--><ul class="nav navbar-nav navbar-right wsh "><li class="dropdown"><a href=" " class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-tag" aria-hidden="true"></span>登录过期啦!请重新登录<span class="caret"></span></a><ul class="dropdown-menu"><li><a id="toLogin" href="#">登陆</a></li><li role="separator" class="divider"></li><li><a id="toRegist" href="#">注册</a></li><!-- <li>< a href="#">注销</ a></li> --></ul></li></ul>')
					}	
				},
				error:function(){
					//location.href=getDict.jumpconfig+"/404.html"
				}	
			});
		}
		
		//注销
			$("body").on("click","#out",function(){
				localStorage.removeItem("token");
				location.reload();
			});
		
		
	
		//弹出登录
		$("body").on("click","#toLogin,#create-btn2",function(){
			
			$("body").append('<div class="sign-in" id="js1"><div id="main-content" class="card"> <header><span class="close" id="close1"></span><span id="bbt-signin-header">账户</span></header> <section><div class="condition2">*为必填项目</div><form action=""><div class="input-row"><h1 class="accounttext">账号*</h1><input id="account" class="account" type="text" placeholder=""/></div><div class="password-row"><div class="display"><a href="javascript:void(0)">显示</a></div><h1 class="passwordtext">密码*</h1><input id="password" class="password" type="password" placeholder=""/><div class="forgetnumber"><a href="javascript:void(0)">忘记密码？</a></div></div><div class="button-row"><button id="submit-btn" type="button">登录</button> </div><div class="tos-pp">继续操作则表示您同意我们的<a id="bbt-tos" href="javascript:void(0)">服务条款</a>和<a id="bbt-pp" href="javascript:void(0)">隐私声明</a></div></form><hr/><div class="button-row"><button id="create-btn" type="submit">创建账户</button></div></section><div class="prompt"><p>通过您的账户，将可以：</p><p>● 查看预期价格</p><p>● 查看您的所有收藏记录和浏览记录</p><p>● 管理您的地址簿，以方便日后订购</p><p>● 更新您的个人资料</p></div></div></div>')
		
		
/* 		let $url = "";
		//获取url的路径
		//获取json文件中的数据				回调函数 当执行完后获取数据后
		$.getJSON("res/serverconfig.json",(responseText)=>{
			$url = responseText.protocol + responseText.domain+ ":" + responseText.port + responseText.context;
			//执行显示是否拿到数据
			window.console.log($url);
		}); */
		
		//显示密码
		$(".display").click(function(){
			let pass_type = $('.password').attr('type');
			if (pass_type === 'password' ){
		          $('.password').attr('type','text');
		          $('.display').html('<a href="javascript:void(0)">隐藏</a>')
		       } else {
		           $('.password').attr('type', 'password');
		           $('.display').html('<a href="javascript:void(0)">显示</a>')
		       }
		})
		//判定账号密码是否为空
		//if($("#account").val() !="" && $("#password").val() != ""){
			$("#submit-btn").click(()=>{
				//先令判定框为空
				$("#judge_loginbtn").html("");
				$("#judge_loginbtn").remove();
				let $data = {
						account: $.trim($("#account").val()),  //trim 去除两端空白符号
						password: $.trim($("#password").val())
						};
				
				//把对象变成字符串 以对应ContentType的json字符串传过去
				let person = JSON.stringify($data);
				$.ajax({
					type:"post",
					url:getDict.serverconfig +"/login.action",
					data:person,
					headers:{"Content-Type":"application/json;charset=UTF-8"},
					dataType:"json",
					async:false,
					//contentType:  这里显示的是表单type传值  一般用json 字符串传值 这样就需要修改contentType
					success: function(responseText){
						
						//当账号和密码一致时
						if(responseText.status ==="200"){
							if(!window.localStorage){
								alert("浏览器不支持localStorage");
							}else{
								//var storage=window.localStorage; 
								//console.log(responseText.token);
								//localStorage.clear();
								/* 存入token  */
								localStorage.setItem("token", responseText.token);
								/* storage["token"]=responseText.token; */
								//$(".forgetnumber").prepend("<span id='judge_loginbtn' style='color:green'>恭喜，登陆成功</span>")
								//console.log(localStorage);
								var returnUrl = localStorage.returnUrl;
								
								localStorage.removeItem("returnUrl");
								//if(returnUrl === undefined){
								//返回当前页面
								//var urls = window.location.href
								
								 window.location.href=getDict.jumpconfig+"/price.html"+url;
								
								//}else{
								//	location.href='http://bbt.com/goodsDetail.html'+returnUrl;  
								//}
								
								//location.href='http://bbt.com/goodsDetail.html'+returnUrl;  
							
		/* 			            storage.clear();
					            console.log(storage); */
							}
						}else{
							$(".forgetnumber").prepend('<span id="judge_loginbtn" style="margin-right:160px;color:red;" >账号或密码错误</span>')
						}	
					},
					error:function(){
						//location.href=getDict.jumpconfig+"/404.html"
					}
				});
				
			});
	})
		// 关闭登录页面
		$("body").on("click","#close1",function(){
				$(this).parents("#js1").remove();
		})
		//关闭注册页面
		$("body").on("click","#close2",function(){
				$(this).parents("#js2").remove();
		})
		
		
		//弹出注册
		$("body").on("click","#toRegist,#create-btn",function(){
			$("#js1").remove()
			$("body").append('<div class="sign-in" id="js2"><div id="main-content2" class="card"><header><span class="close" id="close2"></span><span id="bbt-signin-header2">账户</span></header><section><div class="condition">*必填项目</div><div class="build">创建账户</div><form action=""><div class="name-row"><h1  class="nametext">用户名* </h1><input id="name" class="name" type="text" placeholder=""/></div><div class="input-row"><h1 class="accounttext">账号* </h1><input id="account" class="account" type="text" placeholder=""/></div><div class="password-row"><div class="display"><a href="javascript:void(0)">显示</a></div><h1 id="judgePassword1" class="passwordtext">密码* </h1><input id="password1" class="password" type="password" placeholder=""/></div><div class="password-row"><h1 id="judgePassword2" class="passwordtext">确定密码* </h1><input id="password2" class="password" type="password" placeholder=""/></div><div class="mail-row"><h1 class="mailtext">E-mail* </h1><input id="Email" class="mail" type="text" placeholder=""></div><div class="phone-row"><h1 class="phonetext">手机号码* </h1><input id="tel" class="phone" type="text" placeholder=""></div><div class="ag-po">创建账户，您即同意接受我们的条款《<a id="bbt-ag" href="">比比淘用户注册协议</a>》，并同意您的个人信息遵照《<a id="bbt-po" href="">比比淘隐私政策</a>》</div></form><div class="button-row"><button id="create-btn2" type="submit">创建账户</button></div><hr/></section></div></div>')
			
			//正式注册样式
			var $name = false;
			var $account = false;
			var $passowrd1 = false;
			var $password2 = false;
			var $Email = false;
			var $tel = false;
			
/* 			let $url = "";
			//获取url的路径
			//获取json文件中的数据				回调函数 当执行完后获取数据后
			$.getJSON("res/serverconfig.json",(responseText)=>{
				$url = responseText.protocol + responseText.domain+ ":" + responseText.port + responseText.context;
				//执行显示是否拿到数据
				window.console.log($url);
			}); */
			//function $judge(){
			//	console.log(123)
			//}
			
			// 判定用户账号是否存在
			$("#account").blur(function(){
				//当用户失去焦点时，先去除之前的内容
				$(".tishi2").remove();
				/* $() */
				 let $datas={
						 account :$.trim($("#account").val())
				 }
				 let data = JSON.stringify($datas);
				 if($.trim($("#account").val()).length >=6 && $.trim($("#account").val()).length<=20 ){
					 $.ajax({
							type:"post",
							data:data,
							url: getDict.serverconfig+"/judgeAccount.action",
							dataType:"json",
						 	headers:{"Content-Type":"application/json;charset=UTF-8"},
							success:function(responseText){
								if(responseText.status === 200){
									/* console.log("此用户名可用"); */
									$account = true;
								}else{
									$(".accounttext").append('<span style="color:red" class="tishi2">（此账号已被注册）</span>');
								}
							},
							error:function(){
								//location.href=getDict.jumpconfig+"/404.html"
							}
						 });
				 }else{
					 $(".accounttext").append('<span style="color:red" class="tishi2">（输入的长度要在6-20之间）</span>');
				 }
				});
			
			//判定密码长度
			$("#password1").blur(function(){
				$(".tishi3").remove();
				if($.trim($("#password1").val()).length <6 || $.trim($("#password1").val()).length >20){
					$("#judgePassword1").append('<span style="color:red" class="tishi3">（密码长度需在6-20之间）</span>');
				}else{
					$password1 = true;
				}
			})
			
			// 判定确认密码是否与密码相同
			$("#password2").blur(function(){
				$(".tishi4").remove()
				if($("#password1").val() ==""){
					$("#judgePassword2").append('<span style="color:red" class="tishi4">（密码不能为空）</span>');
				}
				else if($("#password1").val() === $("#password2").val()){
					$password2 = true;
				}else{
					$("#judgePassword2").append('<span style="color:red" class="tishi4">（两次密码输入不一致）</span>');
				}
			})
			
			//判定邮箱格式
			$("#Email").blur(function(){
				$(".tishi5").remove()
				   var reg = new RegExp("^[a-z0-9A-Z]+[- | a-z0-9A-Z . _]+@([a-z0-9A-Z]+(-[a-z0-9A-Z]+)?\\.)+[a-z]{2,}$"); 
				   var email = $('#Email').val();
				   if(email == ''){
					  $(".mailtext").append('<span style="color:red" class="tishi5">（邮箱不能为空）</span>');
				}else if(!reg.test(email)){
					$(".mailtext").append('<span style="color:red"  class="tishi5">（邮箱的格式不正确）</span>');
				}else{
					$Email = true;
				}
				
			})
			//判断手机号码的格式
				$("#tel").blur(function(){
					$(".tishi6").remove();
					var reg = /(1[3-9]\d{9}$)/; 
					var tel = $.trim($("#tel").val());
					if(!reg.test(tel)){
						$(".phonetext").append('<span style="color:red" class="tishi6">（手机的格式不正确）</span>');
					}else{
						$tel = true;
					}
				})
			
		//显示密码
		$(".display").click(function(){
			let pass_type = $('.password').attr('type');
			if (pass_type === 'password' ){
		          $('.password').attr('type', 'text');
		          $('.display').html('<a href="javascript:void(0)">隐藏</a>')
		       } else {
		           $('.password').attr('type', 'password');
		           $('.display').html('<a href="javascript:void(0)">显示</a>')
		       }
		})
			
			//判断名字的长度
			$("#name").blur(function(){
				$(".tishi1").remove();
				if($.trim($("#name").val()).length >1 && $.trim($("#name").val()).length <7){
					$name = true;
				}else{
					$(".nametext").append('<span style="color:red" class="tishi1">（用户名长度需在1-7之间）</span>');
				}
			})
			
			//注册按钮判定
			$("#create-btn2").click(function(){
				$(".tishi8").remove();
				if($name == true && $account == true && $password1 == true && $password2 == true && $Email == true && $tel == true){
					let $datas={
							name: $.trim($("#name").val()),
							account: $.trim($("#account").val()),
							password: $.trim($("#password1").val()),
							Email: $('#Email').val(),
							tel: $.trim($("#tel").val())
						}
					//console.log($datas)
					let data = JSON.stringify($datas);
					$.ajax({
						type:"post",
						data:data,
						url:getDict.serverconfig+ "/regist.action",
						headers:{"Content-Type":"application/json;charset=UTF-8"},
						dataType: "json",
						success:function(responseText){
							if(responseText.rows ===1){
								$("#js2").remove();
								//$(".button-row").after("<span id='judge_registBtn' style='color: green'>注册成功</span>");
								//location.href='http://bbt.com/Login.html';
							}else{
								
								$(".button-row").after('<span style="color:red" class="tishi8">（注册失败啦 请重新注册）</span>');
							}
							
						},
						error:function(){
							//location.href=getDict.jumpconfig+"/404.html"
						}
						
					})
				}else{
					$(".button-row").after('<span style="color:red" class="tishi8">（请先将信息填写完整）</span>');
				}
			})
		})
		
					//用户收藏功能
			//判断用户是否收藏
			//var judgeCollect;
			
			$("#collect").click(function(){
				if($("#out").html() !=="注销"){
					alert("请先进行登录")
				}else{
					//var expectPrices = prompt ("输入预期的价格: ", "");/*第一个变量为提示语，第二个变量为默认初始值*/
					//console.log(expectPrices)
					//if(!isNaN(expectPrices)){
					//true 为没有收藏	
					if(judgeCollect === true){
						var tokens=localStorage.getItem("token");
						let goodsPrices = goodsPrice.replace("￥","")
						
						let $data={
								token: tokens,
								goodsId: goodsId,
								expectPrice:goodsPrices
						}
						let data = JSON.stringify($data)
						
						$.ajax({
							type:"post",
							url:getDict.serverconfig+"/toCollects.action",
							headers:{"Content-Type":"application/json;charset=UTF-8"},
							dataType:"json",
							data:data,
							success:function(responseText){
								if(responseText.status===200){
									//location.href='http://bbt.com/BBT/'
									//console.log("保存成功");
									$("#collect").html("取消收藏")
									judgeCollect=false;
								}else{
									alert("账号已过期  请重新刷新")
								}
								//location.href='http://localhost/search.html?id=123&page=3'
							},
							error:function(){
								//location.href=getDict.jumpconfig+"/404.html"
							}
						})
					}else{
						var tokens=localStorage.getItem("token");
						
						let $data={
								token: tokens,
								goodsId: goodsId
						}
						let data = JSON.stringify($data);
						$.ajax({
							type:"post",
							url:getDict.serverconfig+"/deleteCollects.action",
							headers:{"Content-Type":"application/json;charset=UTF-8"},
							dataType:"json",
							data:data,
							success:function(responseText){
								if(responseText.status===200){
									//location.href='http://bbt.com/BBT/'
									//console.log("删除成功");
									$("#collect").html("收藏")
									judgeCollect=true;
								}else{
									//console.log("账号已过期")
								}
								
								//location.href='http://localhost/search.html?id=123&page=3'
							},
							error:function(){
								//location.href=getDict.jumpconfig+"/404.html"
							}
						
					})

				//	}else{
				//		alert("请输入数字")
				//	}
					
				}
				
				
			}
			
		/* console.log(localStorage); */
	});
			//回车键触发点击事件
			$("input[name='query']").keydown(function(event){
				if(event.keyCode==13){
				$(".autocomplete-button").click();
				}
				})
			//取消原form表单的submit功能
			$("#transient").submit( function () {
	  			return false;
			} );
				//搜索框
		//字段近似值阶段
		//let $url=""
		$.getJSON("res/serverconfig.json",(responseText)=>{
		$url = responseText.protocol + responseText.domain+":"+responseText.port+responseText.context;
			
		});
		
		$(".autocomplete-input").keyup(function(){
			$(".proposal-list").show();
			if($.trim($(".autocomplete-input").val()) != ""){
				let $data = {
						keyword: $.trim($(".autocomplete-input").val())
					};
					
					let digit = JSON.stringify($data)
					$.ajax({
						type:"post",
						url:getDict.serverconfig+"/searchSimilar.action",
						data:digit,
						headers:{"Content-Type":"application/json;charset=UTF-8"},
						dataType:"json",
						success:function(responseText){
							/* 列表属性 */
							
							$(".proposal-list").text("")
			 				for(var one in responseText){ //<li class="proposal">a1</li>  <tr><td class= 'content'>"+responseText[one]+"</td></tr>
								$(".proposal-list").append('<li class="proposal">'+responseText[one]+'</li>')
							} 
							
						},
						error:function(){
							location.href=getDict.jumpconfig+"/404.html"
						}
					})
			}else{
				$(".proposal-list").text("");
			}
		});
		
		// 近似值优化
		$(".autocomplete-input").click(function(){
			$(".proposal-list").show();
		});
		$(document).click(function(e){
			var target = $(e.target);
			if(target.attr("class")==="autocomplete-input") {return;}
			else if(target.attr("class")==="proposal"){
			
				$(".autocomplete-input").val(target.text());
				$(".proposal-list").text("");
				$(".proposal-list").hide();
				}
			else{
				$(".proposal-list").hide();
			
			}
		});
		//鼠标移入后变色
/* 		$(".proposal").mouseover(function(){
			$(this).css("background-color","red")
		}) */
		
		
			//点击搜索触发事物 将关键词存入词库
	$(".autocomplete-button").click(function(){
		if($.trim($(".autocomplete-input").val()) !== ""){
			let $datas={
					content: $.trim($(".autocomplete-input").val())	
				}
				//window.console.log($datas)
				data = JSON.stringify($datas);
				$.ajax({
					type:"post",
					url:getDict.serverconfig+"/search.action",
					data:data,
					headers:{"Content-Type":"application/json;charset=UTF-8"},
					dataType:"json",
					success:function(){
						
						location.href=getDict.jumpconfig+"/goods.html?content="+$.trim($(".autocomplete-input").val())+"&pageCurrent=1";
					},
					error:function(){
						//location.href=getDict.jumpconfig+"/404.html"
					}
				})
		}else{
			//location.href=getDict.jumpconfig+'/index.html';
		}
	})
	

	
	
			//通过商品的id 获取商品的历史时间  历史价格 预测时间 预测价格
			$.ajax({
				type:"get",
				//data:data,
				url:getDict.serverconfig+"/getHisData.action?goodsId="+goodsId,
				headers:{"Content-Type":"application/json;charset=UTF-8"},
				dataType:"json",
				success:function(responseText){
					
					//$("#shopTitle").append(shop);
					//$("textarea[name='detail']").append(responseText.goodsUrl)
					$("#toUrl").append('<a id="toUrls" href="javascript:0">'+responseText.goodsUrl+'</a>')
					$("#toUrls").click(function(){
						window.open(responseText.goodsUrl);
					})

					var max = responseText.price[0]
					//console.log((responseText.price).length)
					var min = responseText.price[0]
					for(var i=0;i<(responseText.price).length;i++){
						
						if(parseInt(responseText.price[i])>max){
							max=responseText.price[i];
							//console.log(max)
						}
						if(parseInt(responseText.price[i])<min){
							min=responseText.price[i];
						}
					}
					var minx = min;
					
				
					var mid = (parseInt(max) - parseInt(min))/5;
					
					var lists=[]
					for(var j=0;j<5;j++){
						lists[j] = min+"-"+(parseInt(min)+parseInt(mid))
						
						min=parseInt(min)+parseInt(mid)
					
					}
					
					//分类各个阶段的数量
					listNum = [0,0,0,0,0]
					for(var i=0;i<(responseText.price).length;i++){
						if(parseInt(responseText.price[i])>minx && parseInt(responseText.price[i])<=parseInt(minx)+parseInt(mid)){
							listNum[0]=parseInt(listNum[0]) + parseInt(1)
						}else if (parseInt(responseText.price[i])<=parseInt(minx)+parseInt(mid)*parseInt(2)){
							//console.log(responseText.price[i])
							//console.log(parseInt(minx))
							listNum[1]=parseInt(listNum[1]) + parseInt(1)
						}else if (parseInt(responseText.price[i])<=parseInt(minx)+parseInt(mid)*parseInt(3)){
							listNum[2]=parseInt(listNum[2]) + parseInt(1)
						}else if (parseInt(responseText.price[i])<=parseInt(minx)+parseInt(mid)*parseInt(4)){
							listNum[3]=parseInt(listNum[3]) + parseInt(1)
						}else if (parseInt(responseText.price[i])<=parseInt(minx)+parseInt(mid)*parseInt(5)){
							listNum[4]=parseInt(listNum[4]) + parseInt(1)
						}else{
							
						}
					}
					
					
					
					
					
					//console.log(responseText.preTime)
					//console.log(responseText.prePrice)
					//折线图
					getFuc(responseText);	
					
					//饼图
					getFuc2(lists,listNum);
					
					//getFuc2(responseText,goo)
					//console.log(responseText.time)
					 
					},
				error:function(){
					//location.href=getDict.jumpconfig+"/404.html"
						}
				}); 
		//标题栏跳往主页
		$("#toIndex").click(function(){
			
			location.href=getDict.jumpconfig+"/index.html";
		})
		//标题栏跳往个人中心
		$("#toPersonal").click(function(){
			location.href=getDict.jumpconfig+"/personal.html";
		})
		//标题栏跳往商品推荐
		$("#toTuijian").click(function(){
			location.href=getDict.jumpconfig+"/tuijian.html";
		})
		
		//最后
})

	})
	//画价格预测图
	function getFuc(responseText,goodsTitle){
		//console.log(responseText.time)
		//console.log(responseText.price[0])
 		TESTER = document.getElementsByClassName('center_text')[0];
 		hoverInfo = document.getElementById('hoverinfo');
		/*  Plotly.plot( TESTER, [{
		 x: responseText.time,
		 y: responseText.price }], {
		 margin: { t: 0 } } ); */
		 var selectorOptions = {
				    buttons: [{
				        step: 'month',
				        stepmode: 'backward',
				        count: 1,
				        label: '1m'
				    }, {
				        step: 'year',
				        stepmode: 'todate',
				        count: 1,
				        label: 'YTD'
				    }, {
				        step: 'year',
				        stepmode: 'backward',
				        count: 1,
				        label: '1y'
				    }],
				};
		var trace2={
				x: responseText.time,
				y:responseText.price,
				mode:'lines',
				type:'Scatter',
				name:'历史价格',
				font:{size:15,color:'#f5f5f5'},
				/* marker:{
					color:'#7ad7f7',
					size:5
				}, */
				line:{
					color: '#82c5fd',
					width: 3
				}
		 };
		 
		 var trace3={
				 x: responseText.preTime,
				 y: responseText.prePrice,
				 mode: 'lines',
				 type:'Scatter',
				 font:{size:15,color:'#f5f5f5'},
				 name:'预测价格',
					/* marker:{
						color:'white',
						size:5
					}, */
				 line:{
						color: '#fa4252',
						width: 3
					}
		 }
		 
		 var data=[trace2,trace3];
		 var layout={
				title:{
					text:responseText.goodsTitle,
					font:{size:15,color:'#f5f5f5'},
				},
				legend:{
					font:{family:'sans-serif',size:15,color:'#f5f5f5'},
				},
				xaxis:{
					showgrid:false,
					rangeselector:selectorOptions,
					fixedrange: true,
					tickfont:{color:'#f5f5f5',size:15},
				},
				yaxis:{fixedrange: true,
					tickfont:{color:'#f5f5f5',size:15},	
				},
				
				paper_bgcolor:'rgba(0,0,0,0)',
				plot_bgcolor:'rgba(0,0,0,0)'
		 };
		 Plotly.newPlot(TESTER,data,layout); 
		 
		 TESTER.on('plotly_hover', function(data){ 
			 var infotext = data.points.map(function(d){ 
				
				 return (d.data.name+':<br/>日期:'+d.x+',<br/> 价格:'+d.y); }
			 
			 ); 
			hoverInfo.innerHTML = infotext.join('<br/>'); }).on('plotly_unhover', function(data){ hoverInfo.innerHTML = ''; });
		 
		 
	}
	function getFuc2(lists,listNum){
 		TESTER = document.getElementById('getImg');
 		var max=listNum[0];
 		var maxNum=0;
 		//console.log(listNum[0])
 		//突出最大部分
 		for(var i=1;i<5;i++){
 			if(max<listNum[i]){
 				max=listNum[i];
 				maxNum=i;
 			}
 		}
 		listBig = [0,0,0,0,0];
 		listBig[maxNum]=0.05
		var data=[{
			values: listNum,
			labels: lists,
			marker:{
				colors:['#7c7fd6','#7874f2','#8e98f5','#b1cbfa','#b5bcfb'],
				//line:{color:'#000000',width:1}
			},
			opacity:0.8,
			//textinfo:'label+percent',
			textfont:{size:15,color:'black'},
			textposition:'auto',
			pull:listBig,
			rotation:30,
			//direction:'clockwise',
			//domain: {column:0},
			//name: '',
			hoverinfo: 'label+percent',
			margin: 0,
			hole: .4,
			type:'pie'
		}];
		var layout={
			//title:'商品的价格分布区间',
			annotations:[{
				font:{
					size:20,
					//color:'white',
				},
				showarrow:false,
				text:'',
				
			}],
			height :610,
			width:435, 
			showlegend: false,
			paper_bgcolor:'rgba(0,0,0,0)',
			margin:{l:0,r:10,b:50,t:50,pad:0},
			//grid:{rows:1,columns:2}
		}
		Plotly.newPlot(TESTER,data,layout);
	}
	
	
</script>
